<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#A7B59E" />
    <title>Panel HarujaGdl</title>

    <link rel="manifest" href="/manifest.webmanifest" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />

    <style>
      :root {
        --fondo: #ffffff;
        --texto: #383234;
        --acento: #a7b59e;
        --beige: #faf6f1;
        --gris: #6b6b6b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: var(--beige);
        color: var(--texto);
        text-align: center;
      }

      .logo img {
        max-width: 220px;
        margin: 28px auto 5px;
        display: block;
      }

      h1 {
        margin-top: 0;
        font-size: 24px;
        font-weight: 700;
        color: var(--texto);
      }

      /* ===== GRIDS ===== */

      .grid,
      .admin-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 22px;
        padding: 22px;
        max-width: 900px;
        margin: auto;
        text-align: center;
      }

      .admin-grid {
        display: none;
      }

/* ===== TARJETAS ===== */

.card,
.admin-card {
  background: #ffffff;
  padding: 22px 16px 18px;
  border-radius: 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  border: 1px solid #f0f0f0;
  transition: transform 0.15s ease, box-shadow 0.15s ease;

  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  height: 300px; /* <- sÃºbelo de 270px a 300px */
}

.btn, .admin-btn {
  margin-top: auto;      /* â† Baja el botÃ³n siempre */
  display: inline-block;
  width: 100%;
  background: var(--acento);
  padding: 10px 0;
  color: white;
  text-decoration: none;
  border-radius: 10px;
  font-size: 14px;
}
      /* ===== ICONOS REDONDOS ===== */

      .icon-circle,
      .admin-icon-circle {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        background: #ffffff;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
        margin: 0 auto 12px;
        transition: transform 0.15s ease;
      }

      .card:hover .icon-circle,
      .admin-card:hover .admin-icon-circle {
        transform: scale(1.05);
      }

      .emoji,
      .admin-icon {
        font-size: 34px;
      }

      /* ===== BOTONES ===== */

      .btn,
      .admin-btn {
        margin-top: auto;
        display: inline-block;
        width: 100%;
        background: var(--acento);
        padding: 10px 0;
        color: white;
        text-decoration: none;
        border-radius: 10px;
        font-size: 14px;
      }

      /* ===== ADMIN BUTTON ===== */

      .admin-section {
        max-width: 900px;
        margin: 10px auto 0;
        padding: 0 22px;
        text-align: center;
      }

      .admin-trigger {
        background: transparent;
        border: none;
        padding: 8px 0;
        cursor: pointer;
        font-size: 15px;
        color: var(--texto);
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="logo">
      <img src="/icons/icon-512.png" alt="HarujaGdl" />
    </div>

    <h1 id="panelTitle">Panel de Herramientas HarujaGdl</h1>

    <!-- PANEL PÃšBLICO -->
    <div id="publicGrid" class="grid">
      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ’¸</span></div>
        <h3>Registro de Venta</h3>
        <p>Registra ventas completas.</p>
        <a class="btn" href="/registro-ventas.html">Ir a app</a>
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ“Š</span></div>
        <h3>Base de datos ventas</h3>
        <p>Consulta historial completo.</p>
        <a
          class="btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/1FvUAsQZr8vqh_OOsHsHjHA7RprV_fmuqikm0U_Ja3_M/edit?gid=1077810078#gid=1077810078"
          >Ir a app</a
        >
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ</span></div>
        <h3>Plan de Lealtad</h3>
        <p>Puntos y clientes.</p>
        <a class="btn" href="/plan-lealtad.html" target="_blank">Ir a app</a>
      </div>

      <!-- ğŸ’š NUEVA TARJETA: BD sistema de lealtad -->
      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ“š</span></div>
        <h3>Base de datos plan de lealtad</h3>
        <p>Base de datos plan de lealtad.</p>
        <a class="btn" target="_blank"
         href="https://docs.google.com/spreadsheets/d/1thDRVw0qmCBfQdNT2-Crv6RrMAzo-AcwNL9q21pODpA/edit?gid=0#gid=0">Ir a app</a>
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ“¦</span></div>
        <h3>Generar Apartados</h3>
        <p>Crea apartados y anticipo.</p>
        <a
          class="btn"
          target="_blank"
          href="https://script.google.com/macros/s/AKfycbz4fkeXmAIj-QbyT8IYRvwiortS4b6vSLj66j_Ph5sdfuczU6ATDRWtY9gY717t7r4i/exec"
          >Ir a app</a
        >
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ—‚ï¸</span></div>
        <h3>BitÃ¡cora de Apartados</h3>
        <p>Status y seguimiento.</p>
        <a
          class="btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/17168QLgL2RQpAOoJmckQCnKRTjGcQxZ-_wKQeCptQkE/edit?usp=sharing"
          >Ver bitÃ¡cora</a
        >
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸŸï¸</span></div>
        <h3>Tickets PDF</h3>
        <p>Carpeta de tickets.</p>
        <a
          class="btn"
          target="_blank"
          href="https://drive.google.com/drive/folders/12yvsXrxUYnfr2o0eMx1uBUllkr7to8RK?usp=drive_link"
          >Abrir carpeta</a
        >
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ§µ</span></div>
        <h3>Registro de Nueva Prenda</h3>
        <p>CÃ³digos nuevos.</p>
        <a
          class="btn"
          target="_blank"
          href="https://script.google.com/macros/s/AKfycbx6OThWWitX9xEANDZEZlC4mbW1k0iTvI8HzqPTPjHcYRvqKykxG3fsk2bIE33z9vOV9w/exec"
          >Ir a app</a
        >
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ’²</span></div>
        <h3>Asignar Precios</h3>
        <p>Define precios finales.</p>
        <a
          class="btn"
          target="_blank"
          href="https://script.google.com/macros/s/AKfycbwYXC1B8txyWogMKrv4eWo-WqkbVh5I5139b5I-028-6_FPD-DVXCR6lWvbSJkLrYIw4g/exec"
          >Ir a app</a
        >
      </div>

      <div class="card">
        <div class="icon-circle"><span class="emoji">ğŸ§®</span></div>
        <h3>Calculadora sobre pedidos</h3>
        <p>Precios estimados.</p>
        <a class="btn" href="/calculadora-pedidos.html">Ir a app</a>
      </div>
    </div>

    <!-- BOTÃ“N ADMIN -->
    <div class="admin-section">
      <button id="adminToggle" class="admin-trigger">ğŸ” Administrador</button>
    </div>

    <!-- PANEL ADMIN -->
    <div id="adminGrid" class="admin-grid">
      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ“¦</span></div>
        <h4>Apartados</h4>
        <p>BD apartados Haruja</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/17168QLgL2RQpAOoJmckQCnKRTjGcQxZ-_wKQeCptQkE/edit?gid=784913066#gid=784913066"
          >Ir a app</a
        >
      </div>

      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ·ï¸</span></div>
        <h4>Est. Precios</h4>
        <p>EstimaciÃ³n de precios</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://script.google.com/macros/s/AKfycby4NNyRSFmQm-dgXf9dpTqVxBDORBtOnPywiffLNyvotUM66ZKjWCFgyIqAX-kPo_M/exec"
          >Ir a app</a
        >
      </div>

      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ§¾</span></div>
        <h4>CÃ³digos</h4>
        <p>BD creaciÃ³n de cÃ³digos</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/1DFIZc3BvqRSvaPqhBm1Geu4aeZji6zuIAZKpkeplpwU/edit?usp=sharing"
          >Ir a app</a
        >
      </div>

      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ“±</span></div>
        <h4>Calculadora (BD)</h4>
        <p>BD calculadora Haruja</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/1hLSh3sqKAi_BC3t6sWhP4Bl0-qlaZbMXhs9tGa0HU2Q/edit?usp=sharing"
          >Ir a app</a
        >
      </div>

      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ“‹</span></div>
        <h4>Master</h4>
        <p>BD precios Haruja</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/1S9mZbcQehmyiwaebh0GKlQQF7HDWLTdvJZFkV-vY_ZA/edit?usp=sharing"
          >Ir a app</a
        >
      </div>
      <!-- NUEVA CARD: Ejecutar pipeline Master -->
      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">âš™ï¸</span></div>
        <h4>Actualizar Master</h4>
        <p>Corre: cÃ³digos nuevos, precios y CSV + IVA.</p>
        <button
          id="btnPipelineMaster"
          class="admin-btn"
          type="button"
          onclick="ejecutarPipelineMaster()"
        >
          Ejecutar actualizaciÃ³n
        </button>
      </div>
      
      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ“„</span></div>
        <h4>BD Tiendanube</h4>
        <p>Base de datos precios</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/1GfXUv-Y143yQJFC-6_kLZH3kT5rid2BLTEFHFKoikyQ/edit?usp=sharing"
          >Ir a app</a
        >
      </div>

      <div class="admin-card">
        <div class="admin-icon-circle"><span class="admin-icon">ğŸ’¾</span></div>
        <h4>CSV SMP</h4>
        <p>BD tickets Haruja</p>
        <a
          class="admin-btn"
          target="_blank"
          href="https://docs.google.com/spreadsheets/d/15ofWXeddksQjaUxpHxSlzq6XrqHsl78CHgcorlBabhI/edit?usp=sharing"
          >Ir a app</a
        >
      </div>
    </div>

  <script>
    const ADMIN_PASSWORD = "Harujagdl";

    const adminToggle = document.getElementById("adminToggle");
    const adminGrid = document.getElementById("adminGrid");
    const publicGrid = document.getElementById("publicGrid");
    const panelTitle = document.getElementById("panelTitle");

    let adminUnlocked = localStorage.getItem("harujaAdmin") === "true";

    function showAdmin() {
      publicGrid.style.display = "none";
      adminGrid.style.display = "grid";
      panelTitle.textContent = "Panel Administrador HarujaGdl";
      adminToggle.textContent = "â¬…ï¸ Volver al panel";
    }

    function showPublic() {
      publicGrid.style.display = "grid";
      adminGrid.style.display = "none";
      panelTitle.textContent = "Panel de Herramientas HarujaGdl";
      adminToggle.textContent = "ğŸ” Administrador";
    }

    if (adminUnlocked) {
      showAdmin();
    }

    adminToggle.addEventListener("click", () => {
      if (!adminUnlocked) {
        const pass = prompt("Introduce la contraseÃ±a de administrador:");
        if (pass === ADMIN_PASSWORD) {
          adminUnlocked = true;
          localStorage.setItem("harujaAdmin", "true");
          showAdmin();
        } else {
          alert("ContraseÃ±a incorrecta.");
        }
      } else {
        if (adminGrid.style.display === "grid") {
          showPublic();
        } else {
          showAdmin();
        }
      }
    });

    // ============================
    //  Pipeline Master desde PWA
    // ============================

    // URL del endpoint del Master (Apps Script)
    const PIPELINE_URL =
      "https://script.google.com/macros/s/AKfycbzbB870s_6tuIjlDbN-CWPiEwVDT8r-gz3U_4iRB366JTWhoqbgvXhVld30_D807grl/exec";

    async function ejecutarPipelineMaster() {
      const btn = document.getElementById("btnPipelineMaster");
      const textoOriginal = btn ? btn.textContent : "";

      const confirmar = confirm(
        "Â¿Quieres ejecutar la actualizaciÃ³n completa del Master?\n\n" +
          "Esto correrÃ¡: cÃ³digos nuevos, precios desde Calculadora y CSV con IVA."
      );
      if (!confirmar) return;

      try {
        if (btn) {
          btn.disabled = true;
          btn.textContent = "Ejecutando...";
        }

        const respuesta = await fetch(PIPELINE_URL + "?action=ejecutarPipeline");
        const data = await respuesta.json();

        if (data.success) {
          alert(
            "âœ… " +
              (data.message ||
                "Pipeline ejecutado correctamente. Revisa el Master.")
          );
        } else {
          alert(
            "âš ï¸ " +
              (data.message || "Hubo un problema al ejecutar el pipeline.")
          );
        }
      } catch (error) {
        console.error(error);
        alert("âŒ Error al conectar con el Master. Intenta de nuevo.");
      } finally {
        if (btn) {
          btn.disabled = false;
          btn.textContent = textoOriginal || "Ejecutar actualizaciÃ³n";
        }
      }
    }
  </script>
</body>
</html>
