<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Registro de Ventas HarujaGdl</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      body {
        font-family: 'Montserrat', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #fff;
        color: #383234;
        margin: 0;
        padding: 0 20px;
      }
      .container {
        max-width: 600px;
        margin: auto;
        padding-bottom: 40px;
      }
      img.logo {
        width: 250px;
        display: block;
        margin: 30px auto 20px;
      }
      h2 {
        text-align: center;
        color: #383234;
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-top: 15px;
        font-weight: bold;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin-top: 5px;
        box-sizing: border-box;
      }
      button {
        margin-top: 25px;
        width: 100%;
        padding: 12px;
        background: #A7B59E;
        color: #fff;
        border: 0;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.6;
        cursor: default;
      }
      .mensaje {
        margin-top: 20px;
        text-align: center;
        font-weight: bold;
      }
      .muted {
        color: #6b7280;
        font-size: 0.9rem;
        text-align: center;
        margin-top: 8px;
      }

      /* Popups */
      dialog {
        border: none;
        border-radius: 12px;
        padding: 25px 30px;
        text-align: center;
        animation: fadeIn 0.3s ease;
        font-weight: 500;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .success {
        background-color: #A7B59E;
        color: #fff;
      }
      .error {
        background-color: #B0413E;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Puedes cambiar la URL del logo si lo mueves a otro lado -->
      <img
        src="https://i.postimg.cc/nMphkZcC/haruja-logo.png"
        alt="HarujaGdl Logo"
        class="logo"
      />
      <h2>Registro de Venta</h2>

      <form id="ventaForm" autocomplete="off">
        <label>Fecha de venta*</label>
        <input type="date" name="fecha" required />

        <label>Vendedora*</label>
        <select name="vendedora" required>
          <option value="Sam">Sam</option>
          <option value="Haru">Haru</option>
          <option value="harujagdl.com">harujagdl.com</option>
        </select>

        <label>Cliente*</label>
        <input type="text" name="cliente" required />

        <label>N√∫mero de contacto*</label>
        <input type="tel" name="contacto" required />

        <label>Canal de venta*</label>
        <select name="canal" required>
          <option value="Tienda f√≠sica">Tienda f√≠sica</option>
          <option value="Harujagdl.com">Harujagdl.com</option>
          <option value="Insta">Instagram</option>
          <option value="Facebook">Facebook</option>
          <option value="Whatsapp">Whatsapp</option>
          <option value="Tianguis">Tianguis</option>
        </select>

        <label>C√≥digo(s) (separar con ,)*</label>
        <input
          type="text"
          name="articulo"
          required
          placeholder="Ej. HA1001, HA1002, HA1003"
        />

        <label>Total*</label>
        <input type="number" name="precio" required />

        <label>M√©todo de pago*</label>
        <select name="pago" required>
          <option value="Efectivo">Efectivo</option>
          <option value="Tarjeta">Tarjeta</option>
          <option value="Transferencia">Transferencia</option>
          <option value="Link de pago">Link de pago</option>
        </select>

        <label>Descuento*</label>
        <select name="descuento" required>
          <option value="No aplica">No aplica</option>
          <option value="10%">10%</option>
        </select>

        <label>Comentario</label>
        <textarea name="comentario" rows="3"></textarea>

        <button id="btnGuardar" type="submit">Guardar venta</button>
        <div class="mensaje" id="mensaje"></div>
        <div class="muted" id="aviso">
          Esta pantalla env√≠a los datos directo a tu Google Sheet de ventas.
        </div>
      </form>
    </div>

    <!-- Pop-ups -->
    <dialog id="dlgOk" class="success">‚úÖ Venta registrada correctamente.</dialog>
    <dialog id="dlgErr" class="error">‚ùå Error al guardar la venta.</dialog>

    <script>
  // üëâ Endpoint de tu Apps Script (implementaci√≥n)
  const ENDPOINT =
    'https://script.google.com/macros/s/AKfycbwkty3K4kZlK_83GRoO0GSf2o7B3aHb2VmuhxtcyK4L4FnWSj7yE7MDdUuvdV32WbFh0g/exec';

  const form    = document.getElementById('ventaForm');
  const mensaje = document.getElementById('mensaje');
  const dlgOk   = document.getElementById('dlgOk');
  const dlgErr  = document.getElementById('dlgErr');
  const btn     = document.getElementById('btnGuardar');

  function showDialog(dlg, text, timeout = 2500) {
    dlg.textContent = text;
    try {
      dlg.showModal();
      setTimeout(() => dlg.close(), timeout);
    } catch (e) {
      alert(text); // fallback por si dialog no es soportado
    }
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const fd   = new FormData(form);
    const data = Object.fromEntries(fd.entries());

    mensaje.textContent = 'Guardando...';
    btn.disabled = true;

    try {
      // Enviamos como x-www-form-urlencoded
      const body = new URLSearchParams(data).toString();

      const res = await fetch(ENDPOINT, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8',
        },
        body,
      });

      btn.disabled = false;
      mensaje.textContent = '';

      // üëá Ya NO intentamos hacer res.json(), solo vemos si respondi√≥ OK
      if (res.ok) {
        showDialog(dlgOk, '‚úÖ Venta registrada correctamente.', 2000);
        form.reset();
      } else {
        const text = await res.text().catch(() => '');
        console.error('Respuesta Apps Script:', text);
        showDialog(
          dlgErr,
          '‚ö†Ô∏è No se pudo guardar la venta. Intenta de nuevo.',
          3000
        );
      }
    } catch (err) {
      btn.disabled = false;
      mensaje.textContent = '';
      showDialog(
        dlgErr,
        '‚ùå Error de red. Verifica tu conexi√≥n e intenta de nuevo.',
        3000
      );
      console.error(err);
    }
  });

  // Evitar que Enter mande el form en inputs normales
  form.addEventListener('keydown', (ev) => {
    if (ev.key === 'Enter' && ev.target.tagName !== 'TEXTAREA') {
      ev.preventDefault();
    }
  });
</script>
  </body>
</html>

